# Kali Upgrade & Maintenance Scripts

Author: Anthony Marturano

This repository contains a small, opinionated set of **root-friendly automation scripts** for maintaining a Kali Linux system. The goal is boring reliability: predictable upgrades, clean kernel hygiene, and log files that never quietly eat your disk.

These scripts are designed to live in `/usr/local/bin`, log to `/var/log/kali_upgrade`, and be executed by **root via cron**.

---

## Scripts Included

### 1. `kali_weekly_upgrade.sh`

**Purpose**
Performs a full system update and upgrade using `apt`, detects newly installed kernels, and schedules a reboot if required.

**What it does**

* Runs `apt update` and `apt upgrade` non-interactively
* Detects installed kernels
* Schedules a reboot if a new kernel is present
* Logs output to `/var/log/kali_upgrade/weekly/`

---

### 2. `kali_post_reboot_cleanup.sh`

**Purpose**
Removes old kernels after a reboot, keeping the system clean and reducing `/boot` clutter.

**What it does**

* Detects the currently running kernel
* Removes all older kernels (excluding meta-packages)
* Runs `apt autoremove`
* Logs output to `/var/log/kali_upgrade/post_reboot/`

---

### 3. `log_cleanup.sh`

**Purpose**
Cleans up old log files generated by the other scripts and warns if total log usage grows too large.

**What it does**

* Deletes logs older than 90 days (configurable)
* Calculates total log directory size
* Emits a warning if size exceeds 500 MB
* Logs its own activity to `/var/log/kali_upgrade/`

---

## Installation & Setup

### 1. Copy Scripts to `/usr/local/bin`

```bash
sudo cp kali_weekly_upgrade.sh /usr/local/bin/
sudo cp kali_post_reboot_cleanup.sh /usr/local/bin/
sudo cp log_cleanup.sh /usr/local/bin/
```

### 2. Make Scripts Executable

```bash
sudo chmod +x /usr/local/bin/kali_weekly_upgrade.sh
sudo chmod +x /usr/local/bin/kali_post_reboot_cleanup.sh
sudo chmod +x /usr/local/bin/log_cleanup.sh
```

### 3. Verify Manual Execution

Before automating anything, run each script once:

```bash
sudo /usr/local/bin/kali_weekly_upgrade.sh
sudo /usr/local/bin/kali_post_reboot_cleanup.sh
sudo /usr/local/bin/log_cleanup.sh
```

Confirm logs are created under:

```text
/var/log/kali_upgrade/
├── weekly/
├── post_reboot/
└── log_cleanup_*.log
```

---

## Cron Job Configuration (Root)

All scripts are intended to run under **root’s crontab**, not a user crontab.

### 1. Edit Root Crontab

```bash
sudo crontab -e
```

### 2. Add the Following Entries

```cron
# Weekly system upgrade (Sunday at 03:00)
0 3 * * 0 /bin/bash /usr/local/bin/kali_weekly_upgrade.sh

# Post-reboot kernel cleanup
@reboot /bin/bash /usr/local/bin/kali_post_reboot_cleanup.sh

# Weekly log cleanup (Sunday at 04:00)
0 4 * * 0 /usr/local/bin/log_cleanup.sh
```

### 3. Save and Exit

Cron will automatically install the schedule. No service restart is required.

---

## Design Notes

* Scripts are **non-interactive** and safe for cron execution
* Logging is explicit and timestamped
* Kernel removal is deferred until after reboot to avoid footguns
* No reliance on user environment variables

---

## Safety & Assumptions

* These scripts assume a **single-user Kali system**
* Designed for rolling releases (`kali-rolling`)
* Root execution is required
* Review scripts before use on production or shared systems

---
s setup aims to make system maintenance quiet, predictable, and boring — which is exactly what infrastructure should be.
