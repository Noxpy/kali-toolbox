# AI-Powered IOC Analysis Lab

## Overview

In this lab, you'll simulate a breach investigation as part of a Security Operations Center (SOC) team. The focus is on leveraging AI (specifically ChatGPT) to accelerate log triage, extract Indicators of Compromise (IOCs), and map those IOCs to the MITRE ATT&CK® framework. You'll validate AI outputs by cross-checking against raw log data to avoid false positives, allowing you to better evaluate AI in real-world SOC workflows.

### Estimated Time Needed: 30 Minutes

---

## Learning Objectives

By the end of this lab, you will be able to:

1. Use ChatGPT to summarize logs and highlight anomalies.
2. Extract potential IOCs from AI summaries.
3. Map IOCs to MITRE ATT&CK techniques.
4. Validate AI outputs against raw logs to ensure accuracy.

---

## Lab Setup

### Step 1: Create Log Directory and Files

On your Kali VM, create the necessary directory and files for the lab:

```bash
# Create the folder and files
sudo mkdir -p /var/logs/lab
sudo touch /var/logs/lab/auth.log /var/logs/lab/syslog
sudo chown $(whoami):$(whoami) /var/logs/lab/auth.log /var/logs/lab/syslog
````

### Step 2: Populate Files with Sample Content

Copy and paste the following content into the respective log files.

#### auth.log

```txt
Oct  9 10:21:43 kali sshd[1023]: Failed password for invalid user admin from 203.0.113.45 port 42105 ssh2
Oct  9 10:21:48 kali sshd[1023]: Failed password for invalid user admin from 203.0.113.45 port 42105 ssh2
Oct  9 10:21:53 kali sshd[1023]: Failed password for invalid user admin from 203.0.113.45 port 42105 ssh2
Oct  9 10:22:05 kali sshd[1044]: Accepted password for student from 203.0.113.45 port 42132 ssh2
Oct  9 10:22:10 kali sudo:  student : TTY=pts/0 ; PWD=/home/student ; USER=root ; COMMAND=/bin/bash
Oct  9 10:23:01 kali CRON[1102]: (root) CMD (/tmp/.update.sh)
Oct  9 10:23:07 kali sshd[1044]: Received disconnect from 203.0.113.45 port 42132:11: disconnected by user
Oct  9 10:25:14 kali sshd[1203]: Failed password for invalid user guest from 198.51.100.25 port 51213 ssh2
Oct  9 10:26:02 kali sshd[1203]: Failed password for invalid user guest from 198.51.100.25 port 51213 ssh2
Oct  9 10:27:10 kali sshd[1203]: Connection closed by 198.51.100.25 port 51213 [preauth]
```

#### syslog

```txt
Oct  9 10:22:12 kali systemd[1]: Started session c1 of user student.
Oct  9 10:23:03 kali systemd[1]: Detected suspicious process: /tmp/.update.sh (PID 1102)
Oct  9 10:23:04 kali kernel: [  134.712345] new connection from 203.0.113.45:42132 -> 192.168.56.101:22
Oct  9 10:23:06 kali audit[1102]: EXECVE /tmp/.update.sh by user student
Oct  9 10:23:09 kali systemd[1]: Removed session c1.
Oct  9 10:24:05 kali rsyslogd: imuxsock lost 0 messages from pid 1 due to rate-limiting
Oct  9 10:24:45 kali kernel: [  157.123456] network packet dropped from 198.51.100.25:51432
Oct  9 10:26:07 kali sshd[1210]: Failed password for root from 203.0.113.99 port 44321 ssh2
```

### Step 3: Quick Verification

To verify the files and content:

```bash
# List files
ls -l /var/logs/lab/

# View the first 15 lines of auth.log
head -n 15 /var/logs/lab/auth.log

# View the last 15 lines of syslog
tail -n 15 /var/logs/lab/syslog
```

---

## Exercise Steps

### Exercise 1: Inspect Raw Logs

Navigate to the log directory and review the logs:

```bash
cd /var/logs/lab
head -n 15 auth.log
tail -n 15 syslog
```

**Key Fields to Identify**:

* **Timestamp**
* **Username**
* **Source IP**
* **Command Executed**

**Why This Step is Important**:
You must understand the raw logs before AI analysis. Cross-checking AI outputs with raw logs is crucial to ensure the AI doesn't produce false positives.

---

### Exercise 2: ChatGPT-Assisted Summarization

**Prompt**:

```
Summarize anomalies in the following Linux auth.log entries. Focus on failed logins, suspicious processes, and privilege escalations.
<PASTE 20–30 LINES FROM auth.log HERE>
```

**Example Response**:

```
I detected the following anomalies:
- 18 failed SSH login attempts from IP 203.0.113.45 between 10:22–10:24.
- A successful login by user 'student' from the same IP immediately after failures.
- Use of 'sudo' by 'student' at 10:31, potentially to escalate privileges.
- Execution of a suspicious script from /tmp/.update.sh shortly after login.
```

**Task**: Record the anomalies ChatGPT highlights in your notes.

---

### Exercise 3: Extract IOCs with ChatGPT

**Prompt**:

```
List Indicators of Compromise (IOCs) in the following summary. Provide them as a clean bullet list of IPs, users, and file paths.
<PASTE ChatGPT'S ANOMALY SUMMARY HERE>
```

**Example Response**:

```
- 203.0.113.45 (attacker IP)
- user: student (compromised account)
- /tmp/.update.sh (suspicious persistence script)
```

**Task**: Save the IOCs to a file `ioc_analysis.txt`.

**Why This Step is Important**:
IOCs are the basis of detection and incident response.

---

### Exercise 4: Map IOCs to MITRE ATT&CK

**Prompt**:

```
Map the following IOCs to MITRE ATT&CK techniques:
- 203.0.113.45 repeated SSH logins
- user 'student' using sudo
- /tmp/.update.sh executed as a script
```

**Example Response**:

```
- 203.0.113.45 → T1078 (Valid Accounts) / T1110 (Brute Force)
- 'student' using sudo → T1068 (Exploitation for Privilege Escalation)
- /tmp/.update.sh script → T1059 (Command and Scripting Interpreter) + T1053 (Scheduled Task/Job if recurring)
```

**Task**: Append mappings to your notes file.

**Why This Step is Important**:
Mapping to MITRE ATT&CK helps standardize intelligence and improves incident reporting.

---

### Exercise 5: Validate IOCs Against Raw Logs

**Prompt**:

Manually confirm that the following IOCs exist in the logs:

```bash
# Search for attacker IP (203.0.113.45)
grep "203.0.113.45" auth.log

# Search for suspicious script execution
grep "/tmp/.update.sh" syslog

# Search for 'sudo' command usage
sudo grep "sudo" auth.log | tail -20
```

**Why This Step is Important**:
Validation ensures that only confirmed IOCs are included in your final analysis. This step helps prevent reliance on AI-generated hallucinations.

---

## Conclusion

In this lab, you used AI (ChatGPT) to assist with log triage and IOC extraction, mapped those IOCs to MITRE ATT&CK, and validated your findings against raw logs. By following this process, you'll be able to more efficiently investigate incidents while ensuring that AI outputs are accurate and actionable.

---

## Additional Notes

* **Safety Reminder**: Never paste production logs into external AI tools. Use only lab-supplied logs.
* **Limitations of AI**: While AI can speed up the analysis process, human validation is always necessary to ensure accurate conclusions.

---

## References

* MITRE ATT&CK Framework: [https://attack.mitre.org/](https://attack.mitre.org/)
* ChatGPT: [https://openai.com/chatgpt](https://openai.com/chatgpt)
