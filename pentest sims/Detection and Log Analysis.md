
# Detection and Log Analysis Lab

## Estimated Time: 60 Minutes

### Overview

The defensive counterpart to exploitation is detection. Security Operations Center (SOC) analysts rely on logs to identify intrusions, from authentication attempts to suspicious process launches. In real-world scenarios, rapid log analysis can mean the difference between stopping an intrusion early or suffering data exfiltration. 

In this lab, you will assume the role of a Blue Team analyst, correlating vulnerability scan data with log evidence to extract Indicators of Compromise (IOCs). This mirrors real Incident Response (IR) workflows, where detection begins by combining threat intelligence and system evidence.

By the end of this lab, you will have both tool-driven context (OpenVAS report) and forensic proof (logs) to connect a plausible exploit path to actual system activity.

### Lab Safety

**Important**: Perform all scans only within your controlled lab network. Do not scan systems you do not own or manage.

---

## Learning Objectives

After completing this lab, you will be able to:

- Run an OpenVAS scan to identify high-risk vulnerabilities on a target host.
- Filter vulnerability results to focus on likely intrusion vectors.
- Analyze authentication and system logs to confirm attacker activity.
- Map observed behaviors to MITRE ATT&CK techniques.

---

## Exercises

### Exercise 0: Pre-checks

1. **Verify OpenVAS (GVM) Installation on Kali VM:**

   Run the following command to check the OpenVAS setup:

   ```bash
   gvm-check-setup


2. **Ensure Target VM is Reachable:**

   Use `ping` or `nmap` to ensure the target machine is reachable:

   ```bash
   ping -c 2 <target_ip>
   ```

   **Why this step is important:**
   Confirming the scanner and target connectivity ensures the scan produces meaningful results.

---

### Exercise 1: Run an OpenVAS Scan

1. **Start Greenbone Services:**

   Run the following command to start Greenbone services:

   ```bash
   sudo gvm-start
   ```

   If the service fails to start, keep running the `gvm-check-setup` command and follow the fix instructions until the installation is successful.

2. **Log into the GSA Web Interface:**

   After starting the service, wait for the "GSA is available at ..." message, and open the URL (default: [https://127.0.0.1:9392](https://127.0.0.1:9392)). Log in.

3. **Create a New Scan Target:**

   * Navigate: `Configuration → Targets → New Target`
   * Name: `Compromised-Host`
   * Host(s): `<target_ip>`
   * Port list: `All TCP`
   * Alive test: `Consider Alive` (ensures scan runs even if ICMP is filtered)
   * Save

4. **Create and Start a Scan Task:**

   * Navigate: `Scans → Tasks → New Task`
   * Name: `Quick Assessment - Compromised-Host`
   * Scan Config: `Full and fast`
   * Target: `Compromised-Host`
   * Save, then click `Start`

   **Why this step is important:**
   "Full and fast" provides broad coverage while completing within the lab's time window.

---

### Exercise 2: Review Vulnerability Results

1. **Review Scan Results:**

   After the scan completes, navigate to `Scans → Reports` and open the latest report.

2. **Filter Results by Severity:**

   * Critical (CVSS v3.1 ≥ 9.0)
   * High (7.0–8.9)

3. **Identify 2–3 Plausible Root Causes of Compromise:**

   Example:

   * Outdated OpenSSH allowing brute-force or information disclosure.
   * Web service misconfigurations enabling directory traversal or RCE.
   * Weak credentials flagged by OpenVAS plugins.

4. **Document Vulnerabilities:**

   Example Documentation:

   * "Relevant because SSH was targeted, and we later saw brute-force attempts in logs."

   **Why this step is important:**
   OpenVAS findings provide theoretical intrusion paths. These need to be correlated with log data to confirm exploitation.

---

### Exercise 3: Analyze Authentication Logs

1. **SSH into the Compromised Host:**

   ```bash
   ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa msfadmin@192.168.1.49
   # Use any password, this should fail
   ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa msfadmin@192.168.1.49
   # Password: msfadmin
   ```

2. **Review Failed Login Attempts:**

   ```bash
   sudo grep "Failed password" /var/log/auth.log | tail -20
   ```

3. **Review Successful Logins:**

   ```bash
   sudo grep "Accepted password" /var/log/auth.log | tail -20
   ```

   **Expected Pattern:**
   Many failed attempts from one IP, followed by a successful login from the same IP.

4. **Alternative Log Checking (journalctl):**

   ```bash
   sudo journalctl -u ssh -S "today" | tail -50
   sudo journalctl -t sshd | grep -E "Failed|Accepted"
   ```

   **Why this step is important:**
   Authentication logs reveal brute-force patterns and identify valid account compromise.

---

### Exercise 4: Analyze System Logs for Suspicious Activity

1. **Review Session Openings and Privilege Escalation Attempts:**

   ```bash
   sudo grep "session opened" /var/log/syslog | tail -20
   sudo grep -E "sudo:|su\[" /var/log/auth.log | tail -30
   ```

2. **Look for Suspicious Commands (Reverse Shells, Downloads):**

   ```bash
   sudo grep -E "bash|/dev/tcp|nc|ncat|curl|wget" /var/log/syslog | tail -30
   sudo grep -E "bash|/dev/tcp|nc|ncat|curl|wget" /var/log/auth.log | tail -30
   ```

3. **Check for Persistence Attempts:**

   ```bash
   sudo grep -i cron /var/log/syslog | tail -30
   systemctl list-unit-files --type=service | grep enabled
   ```

   **Why this step is important:**
   System logs confirm attacker actions after login, such as privilege escalation or persistence.

---

### Exercise 5: Select and Document an IOC

**Acceptable IOC Types Include:**

* Source IP of suspicious successful login.
* Malicious path or filename (e.g., `/tmp/.update.sh`).
* Unexpected processes (e.g., `nc`, `bash`, `curl`).
* New or unexpected user accounts.

**Action:**
Record the exact log line and timestamp of your IOC for later hashing.

**Why this step is important:**
A concrete IOC connects OpenVAS findings to observable system activity, building an evidence-based incident narrative.

---

## Summary

In this lab, you:

1. Verified OpenVAS setup and scanned the compromised host.
2. Identified high-severity vulnerabilities plausibly linked to the attack.
3. Correlated findings with authentication and system logs.
4. Documented a confirmed IOC with timestamp.

---

## Lab Safety Reminder

Always ensure you're operating within a controlled lab environment. Never perform scans on systems you do not own or manage.
